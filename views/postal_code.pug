extends layout


block content
  if error
    h1= error
  else
    -
      function formatUnixDate(unixTimestamp) {
        d = new Date(unixTimestamp*1000);
        days =['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
        mm = d.getMonth() + 1; // getMonth() is zero-based
        dd = d.getDate();
        return [d.getFullYear(), (mm>9 ? '' : '0') + mm,(dd>9 ? '' : '0') + dd
          ].join('-') + ' ' + days[d.getDay()]
        }
    h1  #{mainPostalCode.prefecture}, #{mainPostalCode.division_one}, #{mainPostalCode.municipality}
    if weatherData
      #forecast-header Three Day Forecast
      #3day-forecast
        each item in weatherData
          .forecast
            .weather-image
              - url = `http://openweathermap.org/img/wn/${item.weather[0].icon}@2x.png`
              img(src=url, alt="weather image")
            .date
              = formatUnixDate(item.dt)
            .weather-type
              = item.weather[0].main
            .max-min-temp
              = `Max: ${item.temp.max}° Min: ${item.temp.min}°`
    else
      p Weather could not be loaded
    
    .container
      #map-container
        #map

      #nearPostalCodes-container
        if nearPostalCodes
          each postalCode in nearPostalCodes
            .postal-code
              = `${postalCode.postal_code} - ${postalCode.division_one}`
        else
          p Near Postal Codes could not be found
      

block map_sources
  if location
    script(src="https://api.mapbox.com/mapbox-gl-js/v1.11.1/mapbox-gl.js")
    link(rel="stylesheet", href="https://api.mapbox.com/mapbox-gl-js/v1.11.1/mapbox-gl.css")


block map_setup
  if location
    script.
      mapboxgl.accessToken = 'pk.eyJ1IjoibXVyYXNha2kyOSIsImEiOiJja2NocGd4eGIxNDJhMnJwYm8yNWZqNG95In0.8fAAeOrcQlBiwz_cpGfGyg';
      var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: ["#{location.lon}", "#{location.lat}"],
        zoom: 8
      });

      var marker = new mapboxgl.Marker()
        .setLngLat(["#{location.lon}","#{location.lat}"])
        .addTo(map);

